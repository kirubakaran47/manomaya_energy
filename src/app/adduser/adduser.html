<div class="content-section">
    <div class="row tittle">
        <div class="top col-md-5 align-self-center">
            <h5>Add Staff</h5>
        </div>
        <div class="col-md-7 align-self-center">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
                <li class="breadcrumb-item active">Add Staff</li>
            </ol>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
                <div class="row">
                    <!-- Name Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>UserName <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="username" />
                            <div *ngIf="userForm.get('username')?.invalid && userForm.get('username')?.touched"
                                class="text-danger">
                                Name is required.
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>FullName <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="fullname" />
                            <div *ngIf="userForm.get('fullname')?.invalid && userForm.get('fullname')?.touched"
                                class="text-danger">
                                Name is required.
                            </div>
                        </div>
                    </div>
                    <!-- Phone Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" formControlName="email" />
                            <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched"
                                class="text-danger">
                                Name is required.
                            </div>
                        </div>
                    </div>
                    <!-- Phone Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Phone Number <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" formControlName="phone" />
                            <div *ngIf="userForm.get('phone')?.invalid && userForm.get('phone')?.touched"
                                class="text-danger">
                                Phone number is required.
                            </div>
                            <div *ngIf="userForm.get('phone')?.errors?.['pattern']" class="text-danger">Phone number must be 10 digits.
                            </div>
                        </div>
                    </div>

                    <!-- Address Fields -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Address1 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="address" />
                            <div *ngIf="userForm.get('address')?.invalid && userForm.get('address')?.touched"
                                class="text-danger">
                                Address1 is required.
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Address2</label>
                            <input type="text" class="form-control" formControlName="address2" />
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Address3</label>
                            <input type="text" class="form-control" formControlName="address3" />
                        </div>
                    </div>

                    <!-- City Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>City <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="city" />
                            <div *ngIf="userForm.get('city')?.invalid && userForm.get('city')?.touched"
                                class="text-danger">
                                City is required.
                            </div>
                        </div>
                    </div>

                    <!-- State Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>State <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="state" />
                            <div *ngIf="userForm.get('state')?.invalid && userForm.get('state')?.touched"
                                class="text-danger">
                                State is required.
                            </div>
                        </div>
                    </div>

                    <!-- Country Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Country <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="country" />
                            <div *ngIf="userForm.get('country')?.invalid && userForm.get('country')?.touched"
                                class="text-danger">
                                Country is required.
                            </div>
                        </div>
                    </div>

                    <!-- Pincode Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Pincode <span class="text-danger">*</span></label>
                            <input type="number" maxlength="6" pattern="\d*" class="form-control"
                                formControlName="pincode">
                            <div *ngIf="userForm.get('pincode')?.invalid && userForm.get('pincode')?.touched"
                                class="text-danger">
                                Pincode is required.
                            </div>
                            <div *ngIf="userForm.get('pincode')?.errors?.['pattern']"  class="text-danger">Pincode must be 6 digits.</div>
                        </div>
                    </div>

                    <!-- Gender Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Gender <span class="text-danger">*</span></label>
                            <select class="form-control" formControlName="gender">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                            <div *ngIf="userForm.get('gender')?.invalid && userForm.get('gender')?.touched"
                                class="text-danger">
                                Gender is required.
                            </div>
                        </div>
                    </div>

                    <!-- Status Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Status <span class="text-danger">*</span></label>
                            <select class="form-control" formControlName="status">
                                <option value="">Select</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                            <div *ngIf="userForm.get('status')?.invalid && userForm.get('status')?.touched"
                                class="text-danger">
                                Status is required.
                            </div>
                        </div>
                    </div>

                    <!-- position Field -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Role <span class="text-danger">*</span></label>
                            <select class="form-control" formControlName="access">
                                <option value="">Select</option>
                                <option *ngFor="let role of roles" [value]="role.role_id">{{ role.role_name }}</option>
                            </select>
                            <div *ngIf="userForm.get('access')?.invalid && userForm.get('access')?.touched"
                                class="text-danger">
                                Role is required.
                            </div>
                        </div>
                    </div>

                    <!-- Profile Photo Upload -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Profile Photo <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" formControlName="profile"
                                (change)="onFileChange($event, 'profile')" />
                            <div *ngIf="userForm.get('profile')?.invalid && userForm.get('profile')?.touched"
                                class="text-danger">
                                Profile photo is required.
                            </div>
                            <div *ngIf="preview.profile" class="mt-2">

                                <img [src]="preview.profile" alt="Profile Preview" class="img-thumbnail" width="100"
                                    (click)="viewImage(preview.profile)" style="cursor: pointer;" />
                            </div>

                        </div>
                    </div>

                    <!-- Bank Passbook Upload -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Bank Passbook <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" formControlName="passbook"
                                (change)="onFileChange($event, 'passbook')" />
                            <div *ngIf="userForm.get('passbook')?.invalid && userForm.get('passbook')?.touched"
                                class="text-danger">
                                Passbook photo is required.
                            </div>
                            <div *ngIf="preview.passbook" class="mt-2">
                                <img [src]="preview.passbook" alt="Passbook Preview" class="img-thumbnail" width="100"
                                    (click)="viewImage(preview.passbook)" style="cursor: pointer;" />
                            </div>

                        </div>
                    </div>

                    <!-- Pancard Upload -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Pancard <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" formControlName="pancard"
                                (change)="onFileChange($event, 'pancard')" />
                            <div *ngIf="userForm.get('pancard')?.invalid && userForm.get('pancard')?.touched"
                                class="text-danger">
                                Pancard photo is required.
                            </div>
                            <div *ngIf="preview.pancard" class="mt-2">
                                <img [src]="preview.pancard" alt="Pancard Preview" class="img-thumbnail" width="100"
                                    (click)="viewImage(preview.pancard)" style="cursor: pointer;" />
                            </div>

                        </div>
                    </div>

                    <!-- Aadhar Upload -->
                    <div class="col-12 col-sm-6 col-lg-6">
                        <div class="form-group">
                            <label>Aadhar Upload <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" formControlName="aadhar"
                                (change)="onFileChange($event, 'aadhar')" />
                            <div *ngIf="userForm.get('aadhar')?.invalid && userForm.get('aadhar')?.touched"
                                class="text-danger">
                                Aadhar photo is required.
                            </div>
                            <div *ngIf="preview.aadhar" class="mt-2">
                                <img [src]="preview.aadhar" alt="Aadhar Preview" class="img-thumbnail" width="100"
                                    (click)="viewImage(preview.aadhar)" style="cursor: pointer;" />
                            </div>

                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-lg-12">
                        <div class="form-group">
                            <label>
                                Role Permissions
                            </label>
                        </div>

                        <div class="form-group">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Role</th>
                                        <th><input type="checkbox" (change)="toggleAll('read', $event)"> Read</th>
                                        <th><input type="checkbox" (change)="toggleAll('add', $event)"> Add</th>
                                        <th><input type="checkbox" (change)="toggleAll('edit', $event)"> Edit</th>
                                        <th><input type="checkbox" (change)="toggleAll('delete', $event)"> Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dashboard (locked) -->
                                    <tr>
                                        <td>Dashboard</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['dashboard'].read)"
                                                (change)="togglePermission('dashboard', 'read', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['dashboard'].add)"
                                                (change)="togglePermission('dashboard', 'add', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['dashboard'].edit)"
                                                (change)="togglePermission('dashboard','edit', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['dashboard'].delete)"
                                                (change)="togglePermission('dashboard','delete', $event)"></td>
                                    </tr>

                                    <!-- Shift Entry -->
                                    <tr>
                                        <td>Shift Entry</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['shift_entry'].read)"
                                                (change)="togglePermission('shift_entry', 'read', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['shift_entry'].add)"
                                                (change)="togglePermission('shift_entry', 'add', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['shift_entry'].edit)"
                                                (change)="togglePermission('shift_entry','edit', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['shift_entry'].delete)"
                                                (change)="togglePermission('shift_entry','delete', $event)"></td>
                                    </tr>

                                    <tr>
                                        <td>Purchase Entry</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['purchase_entry'].read)"
                                                (change)="togglePermission('purchase_entry', 'read', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['purchase_entry'].add)"
                                                (change)="togglePermission('purchase_entry', 'add', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['purchase_entry'].edit)"
                                                (change)="togglePermission('purchase_entry','edit', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['purchase_entry'].delete)"
                                                (change)="togglePermission('purchase_entry','delete', $event)"></td>
                                    </tr>

                                    <tr>
                                        <td>Staff</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['staff'].read)"
                                                (change)="togglePermission('staff', 'read', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['staff'].add)"
                                                (change)="togglePermission('staff', 'add', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['staff'].edit)"
                                                (change)="togglePermission('staff','edit', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['staff'].delete)"
                                                (change)="togglePermission('staff','delete', $event)"></td>
                                    </tr>

                                    <tr>
                                        <td>Manage Product</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['manage_product'].read)"
                                                (change)="togglePermission('manage_product', 'read', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['manage_product'].add)"
                                                (change)="togglePermission('manage_product', 'add', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['manage_product'].edit)"
                                                (change)="togglePermission('manage_product','edit', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['manage_product'].delete)"
                                                (change)="togglePermission('manage_product','delete', $event)"></td>
                                    </tr>

                                    <tr>
                                        <td>Add Vendor</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['add_vendor'].read)"
                                                (change)="togglePermission('add_vendor', 'read', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['add_vendor'].add)"
                                                (change)="togglePermission('add_vendor', 'add', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['add_vendor'].edit)"
                                                (change)="togglePermission('add_vendor','edit', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['add_vendor'].delete)"
                                                (change)="togglePermission('add_vendor','delete', $event)">
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>Vendor Details</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['vendor_details'].read)"
                                                (change)="togglePermission('vendor_details', 'read', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['vendor_details'].add)"
                                                (change)="togglePermission('vendor_details', 'add', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['vendor_details'].edit)"
                                                (change)="togglePermission('vendor_details','edit', $event)"></td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['vendor_details'].delete)"
                                                (change)="togglePermission('vendor_details','delete', $event)"></td>
                                    </tr>

                                    <tr>
                                        <td>RPS Details</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['rps_details'].read)"
                                                (change)="togglePermission('rps_details', 'read', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['rps_details'].add)"
                                                (change)="togglePermission('rps_details', 'add', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['rps_details'].edit)"
                                                (change)="togglePermission('rps_details','edit', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['rps_details'].delete)"
                                                (change)="togglePermission('rps_details','delete', $event)">
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>User Profile</td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['user_profile'].read)"
                                                (change)="togglePermission('user_profile', 'read', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['user_profile'].add)"
                                                (change)="togglePermission('user_profile', 'add', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['user_profile'].edit)"
                                                (change)="togglePermission('user_profile','edit', $event)">
                                        </td>
                                        <td><input type="checkbox"
                                                [checked]="selectedRoles.includes(roleMap['user_profile'].delete)"
                                                (change)="togglePermission('user_profile','delete', $event)">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class=" col-md-12 text-center mt-3">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content position-relative">

            <!-- Close Button -->
            <div class="text-end p-2">
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                    x
                </button>
            </div>

            <div class="modal-body text-center">
                <img [src]="selectedImage" alt="Full Preview" class="img-fluid w-100" />
            </div>
        </div>
    </div>
</div>